## 列表 list


```{r, echo=FALSE}
load(file = "rdata/height.RData")
load(file = "rdata/weight.RData")
load(file = "rdata/islocal.RData")
load(file = "rdata/name.RData")
load(file = "rdata/gender.RData")
load(file = "rdata/grade.RData")
load(file = "rdata/birthday.RData")
```

列表是R语言基本数据结构中最为复杂的一种，主要作为两种用途：

* 第一：作为非结构化存储的数据类型，类似于Jason，并且可以同时包含不同的类型的数据，比如字符和数值；

* 第二：作为对象的集合，可以包含多个不同数据对象，比如向量、矩阵、数据库，甚至还可以包含图像、表达式、函数等对象。

### 多种类型的复合数据

比如在员工信息表中，我们将每个员工的信息存储在一个对象中，由于该信息包含了多种不同的模式，故而不能用向量。

```{r}
e_list <- list(name = "宋子启", height = 1.73, weight = 73, islocal = TRUE)
print(e_list)
```

在这个列表 `e_list` 中，`list()`函数定义了一个列表，有多个对象构成（又称为组件），每个对象代表中包含了一个对应的信息。

虽然看起来和向量的定义有些类似，但最大的区别是列表中各元素的模式是可以不同的。

将这个 `e_list` 的信息扩充，每个对象可以包含多个信息，且每个对象中的元素个数相同的话，则可以转为数据框。

实际上，数据框是列表的特殊形式。

```{r}
e_list <- list(name = c("宋子启","张伯仲"), height = c(1.73, 1.68), weight = c(73, 70), islocal = c(TRUE, TRUE))
print(e_list)

# 直接转为数据框
as.data.frame(e_list)
```

### 非结构化的数据存储方式

列表还有一个特点是可以嵌套列表对象，则可使得非结构化的数据仓储变得可能。

在员工信息表中，可以存储技能特长这类数据。由于具体的技能数量是未确定的，且是多选项问题，可以用非结构化的数据格式来存储较为方便（实际上非结构化数据是可以转化为结构化数据的，但如果非结构关系较为负责，这种转化的过程和记录各结构化之间关系的问题反而可能更负责，还不如直接存储非结构化关系更为方便）。

```{r}
e001 <- list(name = "宋子启", height = 1.73, weight = 73, islocal = TRUE, skills = c("SQL", "R"))
e002 <- list(name = "张伯仲", height = 1.68, weight = 70, islocal = TRUE, skills = c("SQL", "R", "Python"))

# list 中包含 list
e_list <- list(e001 = e001, e002 = e002)

# 查看 list 的结构使用 str() 更为方便
str(e_list)
```

### 对象的集合

列表作为对象的集合，最为典型的场景是线性回归模型的结果存储在列表中。

```{r}
# 以自变量为 height 因变量为 weight 的简单线性回归模型 lm(y ~ x)
# 将模型的结果存储在 m_list 这个对象中
m_list <- lm(weight ~ height)

# 线性回归模型会返回非常多的信息，会存在不同对象中，故而使用 list 来存储相对合适
summary(m_list)

```

在日常自定义函数中，如果函数返回的结果包含多种数据（多个对象），将其存储在一个列表中也是最为方便的。

### 列表子集筛选

如果列表对象是有名称属性的，也就是各个组件是有标签的，则可以直接使用 `$` 对象的名字提取该子对象。

将列表作为对象的集合多数属于这种情况，每个子对象通常都有名字便于提取。

```{r}
# 查看对象的名称属性
names(m_list)

# 查看回归模型的残差
m_list$residuals


names(e_list)
e_list$e002
```

如果对象没有名称属性，可使用位置索引，与向量类使用`[]`类似，但子对象的提取需要使用`[[]]`。

```{r}
m_list[[2]] # 等价于 m_list$residuals 因为 residuals 是第2个子对象
```

`[]`通常用来提取子集，返回的结果与与对象具有相同的类型，是一种子结构。该操作符可以用在列表上，但返回的是列表结构。

```{r}
m_list[2]

str(m_list[[2]]) # 返回第二个子对象，是一个向量
str(m_list[2]) # 返回原列表的第二个子列表，还是一个列表
```

在`[[]]`提取子对象后，如果是向量，还可以继续使用`[]`来提取子元素来定位结果的元素；如果是矩阵或数据框还可以用`[,]`定位子集，如果是列表，依然可以用 `[[]]` 来继续提取子集。

```{r}
m_list[[2]][2]  # 第二个子对象的第二个元素

str(m_list[[2]]) # 返回第二个子对象，是一个向量
str(m_list[2]) # 返回原列表的第二个子列表，还是一个列表
```




    


